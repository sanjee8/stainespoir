{# templates/account/outing_print.html.twig #}
<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Autorisation parentale de sortie — Stains Espoir</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root{
            --ink:#111827; --muted:#6b7280; --line:#d1d5db;
        }
        html,body{ margin:0; padding:0; background:#fff; color:var(--ink); font:14px/1.5 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
        .wrap{ max-width:820px; margin:24px auto; padding:0 16px }
        .letter{ border:1px solid var(--line); border-radius:12px; padding:28px }
        h1{ font-size:20px; margin:0 0 6px; text-align:center }
        .sub{ text-align:center; color:var(--muted); margin:0 0 18px }
        .row{ display:flex; gap:10px; margin:8px 0; align-items:flex-start }
        .label{ min-width:150px; font-weight:600 }
        .value{ flex:1; white-space:pre-wrap }
        .dots{ flex:1; border-bottom:1px dotted var(--line); height:1.4em }
        .muted{ color:var(--muted) }
        .actions{ display:flex; gap:10px; margin-bottom:12px }
        .btn{ display:inline-block; border:1px solid var(--line); padding:10px 14px; border-radius:10px; background:#fff; text-decoration:none; color:inherit; cursor:pointer }
        .spacer{ height:10px }
        @media print{
            body{ background:#fff }
            .actions{ display:none !important }
            .wrap{ margin:0; padding:0 }
            .letter{ border:none; border-radius:0; padding:0 }
        }
    </style>
</head>
<body>
{% set child = reg.child %}
{% set lastInitial = (child.lastName|default('')|slice(0,1)|upper) ~ '.' %}
{% set jours = ['lundi','mardi','mercredi','jeudi','vendredi','samedi','dimanche'] %}
{% set mois  = ['janvier','février','mars','avril','mai','juin','juillet','août','septembre','octobre','novembre','décembre'] %}
{% set dnum  = reg.outing.startsAt|date('j') %}
{% set jidx  = reg.outing.startsAt|date('N') - 1 %}
{% set midx  = reg.outing.startsAt|date('n') - 1 %}
{% set jour  = jours[jidx] %}
{% set moisN = mois[midx] %}
{# Heures (sans extension intl). Si endsAt n’existe pas, on ajoute +2h par défaut. #}
{% set startHour = reg.outing.startsAt|date('H') + 0 %}
{% set hasEnds   = reg.outing.endsAt is defined and reg.outing.endsAt %}
{% set endHour   = hasEnds ? (reg.outing.endsAt|date('H') + 0) : (startHour + 2) %}
{% set heureDeb  = startHour ~ 'h' %}
{% set heureFin  = endHour ~ 'h' %}

<div class="wrap">
    <div class="actions">
        <a class="btn" href="{{ path('app_account', { enfant: child.id, tab: 'sorties' }) }}">← Retour</a>
        <button class="btn" onclick="window.print()">Imprimer</button>
    </div>

    <section class="letter">
        <h1>Autorisation parentale de sortie — Stains Espoir</h1>
        <p class="sub">Année scolaire
            {{ ('now'|date('n') >= 9 ? 'now'|date('Y') : ('now'|date('Y') - 1)) }}–{{ ('now'|date('n') >= 9 ? ('now'|date('Y') + 1) : 'now'|date('Y')) }}
        </p>

        <div class="row">
            <div class="label">Enfant :</div>
            <div class="value"><b>{{ child.firstName }} {{ lastInitial }}</b>{% if child.level %} — {{ child.level }}{% endif %}</div>
        </div>

        <div class="row">
            <div class="label">Sortie :</div>
            <div class="value">{{ reg.outing.title }}</div>
        </div>

        <div class="row">
            <div class="label">Quand :</div>
            <div class="value">{{ jour }} {{ dnum }} {{ moisN }} · {{ heureDeb }}–{{ heureFin }}</div>
        </div>

        <div class="row">
            <div class="label">Lieu :</div>
            <div class="value">{{ reg.outing.location }}</div>
        </div>

        <div class="row">
            <div class="label">Description :</div>
            <div class="value">
                {% if reg.outing.description is defined and reg.outing.description %}
                    {{ reg.outing.description|nl2br }}
                {% else %}
                    —
                {% endif %}
            </div>
        </div>

        <div class="spacer"></div>

        <div class="row">
            <div class="label">Parent :</div>
            <div class="value">
                {% if reg.signatureName %}{{ reg.signatureName }}{% else %}<span class="muted">—</span>{% endif %}
            </div>
        </div>

        <div class="row">
            <div class="label">Téléphone :</div>
            <div class="value">
                {% if reg.signaturePhone %}{{ reg.signaturePhone }}{% else %}<span class="muted">—</span>{% endif %}
            </div>
        </div>

        <div class="row" style="align-items:flex-start">
            <div class="label">Infos médicales :</div>
            <div class="value">
                {% if reg.healthNotes %}{{ reg.healthNotes|nl2br }}{% else %}—{% endif %}
            </div>
        </div>

        <p style="margin:14px 0 0">
            Je soussigné(e) autorise la participation de mon enfant à cette sortie.
        </p>

        <div class="spacer"></div>

        <div class="row">
            <div class="label">Fait à</div>
            <div class="dots"></div>
            <div class="label" style="min-width:auto; margin-left:16px">le</div>
            <div class="dots" style="max-width:220px"></div>
        </div>

        <div class="row" style="margin-top:22px">
            <div class="label">Signature :</div>
            <div class="dots"></div>
        </div>
    </section>
</div>
</body>
</html>
